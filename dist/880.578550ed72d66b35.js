"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[880],{6880:(O,b,p)=>{p.r(b),p.d(b,{default:()=>L});var m=p(6814);const C={chart:{aligncaptionwithcanvas:"0",plottooltext:"<b>$dataValue</b> leads received",theme:"fusion"},data:[{value:"41"},{value:"39"},{value:"38"},{value:"32"},{value:"26"},{value:"25"},{value:"25"},{value:"24"},{value:"23"},{value:"22"},{value:"18"},{value:"16"},{value:"15"},{value:"13"},{value:"12"},{value:"11"},{value:"10"},{value:"6"},{value:"4"},{value:"1"},{value:"1"},{value:"1"},{value:"1"}]},y={chart:{lineThickness:"3",lineColor:"#000000",theme:"fusion"},data:[{value:"5.6"},{value:"8.8"},{value:"9.3"},{value:"2"},{value:"5.6"},{value:"0.5"},{value:"9.1"}],trendlines:[{line:[{startvalue:"5.7",color:"#E40303",valueOnRight:"1",thickness:"3"}]}]};var _=p(7818),v=p(8351),I=p(8193),u=p(95),T=p(9299),t=p(9468),A=p(3946),V=p(4143),x=p(8672),w=p(220),S=p(4270);function Z(c,g){if(1&c&&(t.TgZ(0,"option",23),t._uU(1),t.qZA()),2&c){const a=g.$implicit;t.Q6J("value",g.index),t.xp6(1),t.hij("",a.ChartName," ")}}function M(c,g){if(1&c){const a=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(n){t.CHM(a);const r=t.oxw(2);return t.KtG(r.binWidth=n)}),t.qZA()}if(2&c){const a=t.oxw(2);t.Q6J("ngModel",a.binWidth)("disabled",!a.binWidth)}}function j(c,g){if(1&c){const a=t.EpF();t.TgZ(0,"div",18)(1,"div",3)(2,"label"),t._uU(3,"Chart Type"),t.qZA()(),t.TgZ(4,"div",19)(5,"select",20),t.NdJ("ngModelChange",function(n){t.CHM(a);const r=t.oxw();return t.KtG(r.chartId=n)}),t.YNc(6,Z,2,2,"option",21),t.qZA(),t.YNc(7,M,1,2,"input",22),t.qZA()()}if(2&c){const a=t.oxw();t.xp6(5),t.Q6J("ngModel",a.chartId),t.xp6(1),t.Q6J("ngForOf",a.chartList),t.xp6(1),t.Q6J("ngIf","3"===a.chartId)}}function R(c,g){if(1&c){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,i=t.oxw();return t.KtG(i.removeVariableTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&c){const a=g.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getTagValue(a)," ")}}function E(c,g){if(1&c){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,i=t.oxw();return t.KtG(i.removenAlogVariableIdsTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&c){const a=g.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getAnalogTagValue(a)," ")}}function Y(c,g){if(1&c){const a=t.EpF();t.TgZ(0,"div",25),t._uU(1),t.TgZ(2,"span",26),t.NdJ("click",function(){const r=t.CHM(a).$implicit,i=t.oxw();return t.KtG(i.removeAmbientVariableIdsTag(r))}),t._UZ(3,"i",27),t.qZA()()}if(2&c){const a=g.$implicit,e=t.oxw();t.xp6(1),t.hij(" ",e.getAmbientTagValue(a)," ")}}function U(c,g){if(1&c&&(t.TgZ(0,"app-card",28)(1,"div",29)(2,"div",30)(3,"span"),t._uU(4,"Mean: 5"),t.qZA(),t.TgZ(5,"span"),t._uU(6,"Median: 6"),t.qZA(),t.TgZ(7,"span"),t._uU(8,"Mode: 2"),t.qZA(),t.TgZ(9,"span"),t._uU(10,"1st Quartile Range: 2.253"),t.qZA(),t.TgZ(11,"span"),t._uU(12,"2nd Quartile Range: 3.253"),t.qZA(),t.TgZ(13,"span"),t._uU(14,"3rd Quartile Range: 4.253"),t.qZA()()(),t._UZ(15,"fusioncharts",31),t.qZA()),2&c){const a=t.oxw();t.Q6J("options",!1)("customDate",!0),t.xp6(15),t.Q6J("height",a.height)("type",a.type)("dataFormat",a.dataFormat)("dataSource",a.dataSource)}}const F=function(){return["admin"]};let L=(()=>{class c{constructor(a,e,n){this.modalService=a,this.dataAnalyticsService=e,this.spinner=n,this.width="600",this.height="400",this.barType="bar2d",this.lineType="line",this.dataFormat="json",this.barDataSource=C,this.lineDataSource=y,this.lineClass="col",this.labels="",this.type="",this.filterData={productId:"",testRunId:"",variableIds:[],IotPanelId:"",analogVariableIds:[],ambientVariableIds:[]},this.aodd=[],this.eodd=[],this.analogVariableList=[],this.ambientVariableList=[],this.items=[],this.tags=[],this.tagInputControl=new u.NI,this.showChart=!1,this.chartList=[]}ngOnInit(){this.chartList=[{ChartId:"spline",ChartName:"Correlation"},{ChartId:"column2d",ChartName:"Standard Deviation"},{ChartId:"scatter",ChartName:"Linear Regression"},{ChartId:"column2d",ChartName:"Histogram Analysis"}],this.chartId=0,this.type=this.chartList[this.chartId].ChartId;const e=new Date,n=new Date;n.setMonth(n.getMonth()-1),this.endDate=e,this.startDate=n,this.startDate={year:this.startDate.getFullYear(),month:this.startDate.getMonth()+1,day:this.startDate.getDate()},this.endDate={year:this.endDate.getFullYear(),month:this.endDate.getMonth()+1,day:this.endDate.getDate()};const i=new Intl.DateTimeFormat("en-GB",{hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),l=new Date;this.jsEndDate=l;const s=i.format(l),o=new Date;this.jsStartDate=o,o.setDate(o.getDate()-1);const d=i.format(o);this.formattedDateTimeRange=d+" - "+s}getTagValue(a){let e;return e="EODD"==this.projectType?this.eodd.find(n=>n.id==a):this.aodd.find(n=>n.id==a),e?.name}getAnalogTagValue(a){return this.analogVariableList.find(e=>e.VariableId==a)?.VariableName}getAmbientTagValue(a){return this.ambientVariableList.find(e=>e.VariableId==a)?.VariableName}removeVariableTag(a){this.filterData.variableIds=this.filterData.variableIds.filter(e=>e!==a)}removenAlogVariableIdsTag(a){this.filterData.analogVariableIds=this.filterData.analogVariableIds.filter(e=>e!==a)}removeAmbientVariableIdsTag(a){this.filterData.ambientVariableIds=this.filterData.ambientVariableIds.filter(e=>e!==a)}openDateTimeModal(){const e=this.jsEndDate,i={startDate:(0,m.p6)(this.jsStartDate,"YYYY-MM-dd HH:mm:ss","en_US"),endDate:(0,m.p6)(e,"YYYY-MM-dd HH:mm:ss","en_US")},l=this.modalService.open(I.Z);l.componentInstance.inputData=i,l.result.then(s=>{const d=new Intl.DateTimeFormat("en-GB",{hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),h=new Date(s.dateData.startDate.year,s.dateData.startDate.month-1,s.dateData.startDate.day,s.dateData.startTime.hour,s.dateData.startTime.minute,0),f=d.format(h),D=new Date(s.dateData.endDate.year,s.dateData.endDate.month-1,s.dateData.endDate.day,s.dateData.endTime.hour,s.dateData.endTime.minute,0),N=d.format(D);this.formattedDateTimeRange=f+" - "+N,this.jsStartDate=h,this.jsEndDate=D},s=>{console.log(`Modal dismissed with: ${s}`)})}openModal(){const e=this.jsEndDate,l={startDate:(0,m.p6)(this.jsStartDate,"YYYY-MM-dd HH:mm:ss","en_US"),endDate:(0,m.p6)(e,"YYYY-MM-dd HH:mm:ss","en_US"),filterData:this.filterData,projectType:this.projectType,name:this.chartList[this.chartId].ChartName},s=this.modalService.open(T.Z,{size:"lg"});s.componentInstance.inputData=l,s.result.then(o=>{1==o.isSearch&&(this.filterData=o.filterData,this.ambientVariableData=o.ambientVariableData,this.filterData.analogVariableIds.forEach(d=>{const h=d;this.tags.includes(h)||this.tags.push(h)}),this.filterData.variableIds.forEach(d=>{const h=d;this.tags.includes(h)||this.tags.push(h)}),this.filterData.ambientVariableIds.forEach(d=>{const h=d;null!=h&&null!=h&&(this.tags.includes(h)||this.tags.push(h))}),this.aodd=o.aodd,this.eodd=o.eodd,this.projectType=o.projectType,this.analogVariableList=o.analogVariableList,this.ambientVariableList=o.ambientVariableList)},o=>{console.log(`Modal dismissed with: ${o}`)})}changeChart(){const a=this.chartList[this.chartId].ChartName;if("Linear Regression"===a){let e=1;const n={chart:{caption:"",yaxisname:"",subcaption:"",showhovereffect:"1",numbersuffix:"",drawcrossline:"",plottooltext:"",theme:"fusion"},dataset:[],dataLabels:{enabled:!1}};if(Array.isArray(this.projectChartRawData)&&this.projectChartRawData.length>0&&this.filterData.variableIds.forEach(r=>{const i=[];this.projectChartRawData.forEach(s=>{const o={x:e++,y:s[r]};i.push(o)}),n.dataset.push({showRegressionLine:"1",data:i})}),this.analogChartRawData){const r=this.analogChartRawData.filter(l=>this.filterData.analogVariableIds.includes(l.data)),i=[];r.forEach(l=>{const s=l.data;let o=i.find(d=>d.data===s);o||(o={data:s,values:[]},i.push(o)),o.values.push({Value:l.Value,DateTime:l.DateTime})}),r.length>0&&i[0].values.length>0&&i.forEach(l=>{const s=[];l.values.forEach(d=>{const h={x:e++,y:d.Value};s.push(h)}),n.dataset.push({showRegressionLine:"1",data:s})})}this.ambientChartRawData&&this.ambientChartRawData.length>0&&this.filterData.ambientVariableIds.forEach(r=>{const i=[];this.ambientChartRawData.forEach(s=>{const o={x:e++,y:s[r]};i.push(o)}),n.dataset.push({showRegressionLine:"1",data:i})}),this.type=this.chartList[this.chartId].ChartId,this.dataSource=n}else if("Histogram Analysis"==a){const e={chart:{caption:"",yaxisname:"",subcaption:"",showhovereffect:"1",numbersuffix:"",drawcrossline:"",plottooltext:"",theme:"fusion"},data:[],dataLabels:{enabled:!1}},n=[];if(this.filterData.variableIds.length&&Array.isArray(this.projectChartRawData))this.filterData.variableIds.forEach(s=>{this.projectChartRawData.forEach(o=>{n.push(o[s])})});else if(this.filterData.analogVariableIds.length&&this.analogChartRawData){const s=this.analogChartRawData.filter(d=>this.filterData.analogVariableIds.includes(d.data)),o=[];s.forEach(d=>{const h=d.data;let f=o.find(D=>D.data===h);f||(f={data:h,values:[]},o.push(f)),f.values.push({Value:d.Value,DateTime:d.DateTime})}),s.length>0&&o[0].values.length>0&&o.forEach(d=>{d.values.forEach(h=>{n.push(h.Value)})})}else if(this.filterData.ambientVariableIds.length&&this.ambientChartRawData&&this.ambientChartRawData.length>0){const s=[];this.filterData.ambientVariableIds.forEach(o=>{this.ambientChartRawData.forEach(d=>{s.push(d[o])})})}n.sort();let i,r=10;this.binWidth?(r=(n[n.length-1]-n[0])/+this.binWidth,i=+this.binWidth):(i=(n[n.length-1]-n[0])/r,this.binWidth=i);let l=0;for(let s=1;s<=r;s++){const d=l+i;e.data.push({label:`[${l} - ${d}]`,value:this.countInRange(n,l,d)}),l=d}this.type=this.chartList[this.chartId].ChartId,this.dataSource=e}this.showChart=!0,this.spinner.hide()}generateChart(){this.showChart=!1,this.spinner.show();const a=this.filterData,e=new Date(this.startDate.year,this.startDate.month-1,this.startDate.day),n=new Date(this.endDate.year,this.endDate.month-1,this.endDate.day);let r={};if(""==a.productId&&0==a.variableIds.length)r={start:e,end:n};else if(""==a.productId&&a.variableIds.length>0)r={start:e,end:n,Data:a.variableIds};else if(""!=a.productId&&0==a.variableIds.length)r={start:e,end:n,id:a.productId,no:a.testRunId};else if(""!=a.productId&&a.variableIds.length>0){r={start:e,end:n,id:a.productId,no:parseInt(a.testRunId),Data:a.variableIds};const i=a.variableIds.map(l=>`\`${l}\``);r.Data=i}if("2"==this.chartId||"3"==this.chartId)if(this.filterData.variableIds.length)this.dataAnalyticsService.getProjectSectionChartData(r).subscribe({next:i=>{this.projectChartRawData=i,this.changeChart()},error:i=>{console.log(i)}});else if(this.filterData.analogVariableIds.length){const i={start:e,end:n};if(a.analogVariableIds.length>0){const l=a.analogVariableIds.map(s=>`\`${s}\``);i.Data=l}this.dataAnalyticsService.getAnalogSectionChartData(i).subscribe({next:l=>{this.analogChartRawData=l,this.changeChart()},error:l=>{console.log(l)}})}else if(this.filterData.ambientVariableIds.length){const i={start:e,end:n};if(a.ambientVariableIds.length>0){const l=a.ambientVariableIds.map(s=>`\`${s}\``);i.Data=l}this.dataAnalyticsService.getAmbientSectionChartData(i).subscribe({next:l=>{this.ambientChartRawData=l,this.changeChart()},error:l=>{console.log(l)}})}}countInRange(a,e,n){let r=0;for(const i of a)i>=e&&i<n&&r++;return r}static#t=this.\u0275fac=function(e){return new(e||c)(t.Y36(A.FF),t.Y36(V._),t.Y36(x.t2))};static#a=this.\u0275cmp=t.Xpm({type:c,selectors:[["app-data-analytics-state"]],standalone:!0,features:[t.jDz],decls:30,vars:8,consts:[["type","ball-scale-multiple"],[1,"custom-card",3,"customHeader"],[1,"form-group","row"],[1,"col-md-3"],[1,"col-md-9"],[1,"custom-datetime-range-span",3,"click"],[1,"fas","fa-calendar"],["class","form-group row align-items-center",4,"appHasRoles"],[1,"col-md-9","disp-flex"],["type","button","ngbAutofocus","",1,"btn","btn-outline-secondary","tag-btn",3,"click"],[1,"fas","fa-plus"],[1,"tag-input"],["class","tag",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-12"],["type","button","ngbAutofocus","",1,"btn","btn-block","btn-primary","mb-4","custom-btn","btn-apply",3,"click"],[1,"fas","fa-check"],["cardTitle","Trend","blockClass","d-flex",3,"options","customDate",4,"ngIf"],[1,"form-group","row","align-items-center"],[1,"col-md-3","d-flex","gap-2"],[1,"form-control",2,"flex","0.7",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","class","form-control","style","flex:0.3;",3,"ngModel","disabled","ngModelChange",4,"ngIf"],[3,"value"],["type","text",1,"form-control",2,"flex","0.3",3,"ngModel","disabled","ngModelChange"],[1,"tag"],[1,"remove",3,"click"],[1,"fas","fa-times"],["cardTitle","Trend","blockClass","d-flex",3,"options","customDate"],[1,"app-card-subheader","d-flex","justify-content-between"],[1,"d-flex","gap-3"],["width","100%",3,"height","type","dataFormat","dataSource"]],template:function(e,n){1&e&&(t._UZ(0,"ngx-spinner",0),t.TgZ(1,"div")(2,"app-card",1)(3,"div",2)(4,"div",3)(5,"label"),t._uU(6,"Data Source & Analysis Tool"),t.qZA()(),t.TgZ(7,"div",4)(8,"span",5),t.NdJ("click",function(){return n.openDateTimeModal()}),t._UZ(9,"i",6),t._uU(10),t.qZA()()(),t.YNc(11,j,8,3,"div",7),t.TgZ(12,"div",2)(13,"div",3)(14,"label"),t._uU(15,"Selected Tags"),t.qZA()(),t.TgZ(16,"div",8)(17,"button",9),t.NdJ("click",function(){return n.openModal()}),t._uU(18," Add Tags "),t._UZ(19,"i",10),t.qZA(),t.TgZ(20,"div",11),t.YNc(21,R,4,1,"div",12),t.YNc(22,E,4,1,"div",12),t.YNc(23,Y,4,1,"div",12),t.qZA()()(),t.TgZ(24,"div",13)(25,"div",14)(26,"button",15),t.NdJ("click",function(){return n.generateChart()}),t._UZ(27,"i",16),t._uU(28," Apply "),t.qZA()()()(),t.YNc(29,U,16,6,"app-card",17),t.qZA()),2&e&&(t.xp6(2),t.Q6J("customHeader",!0),t.xp6(8),t.hij(" ",n.formattedDateTimeRange," "),t.xp6(1),t.Q6J("appHasRoles",t.DdM(7,F)),t.xp6(10),t.Q6J("ngForOf",n.filterData.variableIds),t.xp6(1),t.Q6J("ngForOf",n.filterData.analogVariableIds),t.xp6(1),t.Q6J("ngForOf",n.filterData.ambientVariableIds),t.xp6(6),t.Q6J("ngIf",n.showChart))},dependencies:[m.ez,m.sg,m.O5,_.m,u.YN,u.Kr,u.Fj,u.EJ,u.JJ,u.On,w.A,S.c,x.Ro,v.Qf,v.PZ],styles:[".bi-calendar3{margin-bottom:0}  .btn-apply{padding:2px 8px!important;margin-left:5px}  .custom-card .card{background:linear-gradient(to bottom,rgba(0,190,219,.1490196078),rgba(12,255,0,.1490196078))!important}  .custom-card .card .card-header h5,   .custom-card .card .card-header .h5{font-weight:400;font-size:12px}  .custom-card .input-group.dp .form-control{background:transparent;margin-bottom:5px;padding:0 15px;font-size:14px;line-height:.5;height:25px}  .custom-card .input-group.dp .bi-calendar3.btn{padding-bottom:0!important;padding-top:0!important}  .custom-card select.form-control{background-color:#f5f5f5;line-height:15px}  .custom-card .card .card-header{padding:10px 25px}  .custom-card .card .card-body{padding:10px 25px}  .custom-card .card .card-header .card-header-right .btn.dropdown-toggle{display:none}  .custom-card .form-group label{font-weight:400}  .custom-card .form-control{font-size:14px;line-height:1}  .custom-btn.btn{border-radius:20px;margin:5px!important}  .tag-btn{border-radius:20px;margin-bottom:5px!important;font-size:10px;padding-left:5px;padding-right:5px;margin-right:0!important;margin-top:4px}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .card-header-right[_ngcontent-%COMP%]   .btn.dropdown-toggle[_ngcontent-%COMP%]{display:none}.tag-input[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin:0}.tag[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;padding:6px 8px;margin:0 4px;display:flex;align-items:center;border-radius:20px;font-size:10px}.remove[_ngcontent-%COMP%]{cursor:pointer;margin-left:4px;font-weight:700}.disp-flex[_ngcontent-%COMP%]{display:flex}.custom-datetime-range-span[_ngcontent-%COMP%]{padding:2px 8px;border:solid 1px rgb(206,212,218);border-radius:20px}.custom-datetime-range-span[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:15px}"]})}return c})()}}]);